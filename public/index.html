<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des √âtudiants</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .content {
      padding: 30px;
    }

    .section {
      margin-bottom: 40px;
    }

    .section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.8em;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #555;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 5px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 15px;
    }

    @media (max-width: 1024px) {
      .form-row {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 640px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 5px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .btn-danger:hover {
      box-shadow: 0 10px 20px rgba(245, 87, 108, 0.4);
    }

    .btn-success {
      margin-right: 10px;
    }

    .search-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-container input {
      flex: 1;
    }

    .students-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .students-table thead {
      background-color: #f5f5f5;
    }

    .students-table th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #667eea;
      border-bottom: 2px solid #e0e0e0;
    }

    .students-table td {
      padding: 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    .students-table tbody tr:hover {
      background-color: #f9f9f9;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
    }

    .btn-delete {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      padding: 8px 15px;
      font-size: 0.9em;
    }

    .btn-modify {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 8px 15px;
      font-size: 0.9em;
    }

    .btn-modify:hover {
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .empty-message {
      text-align: center;
      padding: 40px;
      color: #999;
      font-size: 1.1em;
    }

    .alert {
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }

    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 2em;
      margin-bottom: 5px;
    }

    .stat-card p {
      font-size: 0.9em;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìö Gestion des √âtudiants</h1>
      <p>G√©rez efficacement votre liste d'√©tudiants</p>
    </header>

    <div class="content">
      <!-- Section des statistiques -->
      <div class="stats">
        <div class="stat-card">
          <h3 id="studentCount">0</h3>
          <p>√âtudiants inscrits</p>
        </div>
      </div>

      <!-- Messages d'alerte -->
      <div id="alertContainer"></div>

      <!-- Section pour ajouter un √©tudiant -->
      <div class="section">
        <h2>‚ûï Ajouter un nouvel √©tudiant</h2>
        <form id="addStudentForm">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Nom complet <span style="color: red;">*</span></label>
              <input type="text" id="name" name="name" required placeholder="ex: Jean Dupont">
            </div>
            <div class="form-group">
              <label for="email">Email <span style="color: red;">*</span></label>
              <input type="email" id="email" name="email" required placeholder="ex: jean@example.com">
            </div>
            <div class="form-group">
              <label for="phone">T√©l√©phone</label>
              <input type="tel" id="phone" name="phone" placeholder="ex: 06 12 34 56 78">
            </div>
            <div class="form-group">
              <label for="specialty">Sp√©cialit√©</label>
              <input type="text" id="specialty" name="specialty" placeholder="ex: Informatique">
            </div>
          </div>
          <button type="submit" class="btn-success">Ajouter l'√©tudiant</button>
        </form>
      </div>

      <!-- Section pour rechercher -->
      <div class="section">
        <h2>üîç Rechercher</h2>
        <div class="search-container">
          <input type="text" id="searchInput" placeholder="Rechercher par nom...">
          <button onclick="searchStudents()">Rechercher</button>
          <button onclick="loadStudents()">R√©initialiser</button>
        </div>
      </div>

      <!-- Section pour afficher la liste des √©tudiants -->
      <div class="section">
        <h2>üìã Liste des √©tudiants</h2>
        <table class="students-table" id="studentsTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Email</th>
              <th>T√©l√©phone</th>
              <th>Sp√©cialit√©</th>
              <th>Date d'inscription</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="studentsList">
            <tr>
              <td colspan="7" class="empty-message">Aucun √©tudiant pour le moment</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Charger les √©tudiants au chargement de la page
    document.addEventListener('DOMContentLoaded', loadStudents);

    // G√©rer la soumission du formulaire
    document.getElementById('addStudentForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const specialty = document.getElementById('specialty').value;

      try {
        const response = await fetch('/api/students', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name, email, phone, specialty })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error);
        }

        showAlert('√âtudiant ajout√© avec succ√®s!', 'success');
        document.getElementById('addStudentForm').reset();
        loadStudents();
      } catch (error) {
        showAlert('Erreur: ' + error.message, 'error');
      }
    });

    // Charger tous les √©tudiants
    async function loadStudents() {
      try {
        const response = await fetch('/api/students');
        if (!response.ok) throw new Error('Erreur lors du chargement');

        const students = await response.json();
        displayStudents(students);
        updateStudentCount(students.length);
      } catch (error) {
        showAlert('Erreur: ' + error.message, 'error');
      }
    }

    // Afficher les √©tudiants dans le tableau
    function displayStudents(students) {
      const tbody = document.getElementById('studentsList');

      if (students.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-message">Aucun √©tudiant pour le moment</td></tr>';
        return;
      }

      tbody.innerHTML = students.map(student => `
        <tr>
          <td>${student.id}</td>
          <td>${student.name}</td>
          <td>${student.email}</td>
          <td>${student.phone || '-'}</td>
          <td>${student.specialty || '-'}</td>
          <td>${new Date(student.createdAt).toLocaleDateString('fr-FR')}</td>
          <td>
            <div class="action-buttons">
              <button class="btn-modify" onclick="openModifyModal(${student.id}, '${student.name}', '${student.email}', '${student.phone}', '${student.specialty}')">Modifier</button>
              <button class="btn-delete" onclick="deleteStudent(${student.id})">Supprimer</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Supprimer un √©tudiant
    async function deleteStudent(id) {
      if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet √©tudiant?')) return;

      try {
        const response = await fetch(`/api/students/${id}`, {
          method: 'DELETE'
        });

        if (!response.ok) throw new Error('Erreur lors de la suppression');

        showAlert('√âtudiant supprim√© avec succ√®s!', 'success');
        loadStudents();
      } catch (error) {
        showAlert('Erreur: ' + error.message, 'error');
      }
    }

    // Rechercher les √©tudiants
    async function searchStudents() {
      const searchTerm = document.getElementById('searchInput').value;

      if (!searchTerm) {
        loadStudents();
        return;
      }

      try {
        const response = await fetch(`/api/students/search/${encodeURIComponent(searchTerm)}`);
        if (!response.ok) throw new Error('Erreur lors de la recherche');

        const students = await response.json();
        displayStudents(students);
        updateStudentCount(students.length);
      } catch (error) {
        showAlert('Erreur: ' + error.message, 'error');
      }
    }

    // Mettre √† jour le compteur d'√©tudiants
    function updateStudentCount(count) {
      document.getElementById('studentCount').textContent = count;
    }

    // Afficher une alerte
    function showAlert(message, type) {
      const container = document.getElementById('alertContainer');
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type}`;
      alertDiv.textContent = message;

      container.innerHTML = '';
      container.appendChild(alertDiv);

      setTimeout(() => alertDiv.remove(), 5000);
    }

    // Ouvrir le modal de modification
    function openModifyModal(id, name, email, phone, specialty) {
      const newName = prompt(`Modifier le nom (actuel: ${name}):`, name);
      if (newName === null) return;

      const newEmail = prompt(`Modifier l'email (actuel: ${email}):`, email);
      if (newEmail === null) return;

      const newPhone = prompt(`Modifier le t√©l√©phone (actuel: ${phone}):`, phone || '');
      if (newPhone === null) return;

      const newSpecialty = prompt(`Modifier la sp√©cialit√© (actuel: ${specialty}):`, specialty || '');
      if (newSpecialty === null) return;

      modifyStudent(id, newName, newEmail, newPhone, newSpecialty);
    }

    // Modifier un √©tudiant avec la fonction PATCH (avec le bug intentionnel)
    async function modifyStudent(id, name, email, phone, specialty) {
      try {
        const response = await fetch(`/api/students/${id}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name, email, phone, specialty })
        });

        if (!response.ok) throw new Error('Erreur lors de la modification');

        const result = await response.json();
        showAlert(`√âtudiant modifi√© - Attention: Email et Sp√©cialit√© peuvent √™tre swapp√©s (BUG!)`, 'success');
        console.log('Modification result:', result);
        loadStudents();
      } catch (error) {
        showAlert('Erreur: ' + error.message, 'error');
      }
    }
  </script>
</body>
</html>
